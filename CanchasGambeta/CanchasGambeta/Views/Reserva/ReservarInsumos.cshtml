@model CanchasGambeta.ViewModels.VistaReservarInsumos
@using CanchasGambeta.Models
@{
    ViewBag.Title = "ReservarInsumos";
    var sesion = (Usuario)HttpContext.Current.Session["User"];
}

<div class="row" style="transform: translateY(60px); color: white">
    <div class="col-md-3"></div>
    <div class="col-md-6">
        <h4 class="text-center">¿Desea reservar algún insumo del kiosko?</h4>
        @using (Html.BeginForm("BuscarInsumo", "Reserva", FormMethod.Post))
        {
            @Html.HiddenFor(Model => Model.NuevaReservaVM.idReserva)
            <div class="form-horizontal">
                <div class="col-md-12 form-group btn-group">
                    <input type="hidden" name="buscarInsumoAnterior" value="@ViewBag.nombreInsumo" class="form-control" />
                    @if (ViewBag.nombreInsumo != null)
                    {
                        <input type="text" id="buscarInsumo" name="buscarInsumo" value="@ViewBag.nombreInsumo" class="form-control" />
                    }
                    else
                    {
                        <input type="text" id="buscarInsumo" name="buscarInsumo" class="form-control" />
                    }
                    <button type="submit" class="btn btn-primary ml-2" id="botonBuscar">Buscar</button>
                </div>
            </div>
            <div class="form-label-group text-danger pb-2">
                @ViewBag.ErrorBuscarInsumo
            </div>
            <div style="display:none">
                @foreach (var item in Model.InsumosAPedir)
                {
                    <input type="hidden" name="listaIdInsumoAlPedido" value="@item.IdInsumo" readonly />
                    <input type="text" name="listaNombreInsumoAlPedido" value="@item.Insumo" readonly />
                    <input type="number" name="listaCantidadInsumoAlPedido" value="@item.Cantidad" readonly />
                }
            </div>
        }
    </div>
    <div class="col-md-3"></div>
</div>

<div class="row" style="transform: translateY(60px); color: white">
    <div class="col-md-1"></div>
    <div class="col-md-5">
        <h4 class="text-center">Insumos encontrados</h4>
        @if (Model.BuscarInsumos.Count != 0)
        {
            <table class="tablacustom">
                <thead>
                    <tr>
                        <th class="text-center thfix">
                            Insumo
                        </th>
                        <th class="text-center thfix">
                            Acciones
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var listado in Model.BuscarInsumos)
                    {
                        using (Html.BeginForm("AgregarInsumos", "Reserva", FormMethod.Post))
                        {
                            <tr>
                                <td>
                                    @Html.HiddenFor(Model => Model.NuevaReservaVM.idReserva)
                                    <input type="hidden" name="buscarInsumoAnterior" value="@ViewBag.nombreInsumo" class="form-control" />
                                    <input type="hidden" name="idInsumo" value="@listado.IdInsumo" />
                                    <input type="text" name="nombreInsumo" class="form-control" placeholder="@listado.Insumo" value="@listado.Insumo" readonly />
                                    <input type="hidden" name="stockInsumo" value="@listado.Stock" />
                                </td>
                                <td class="text-center">
                                    @foreach (var item in Model.InsumosAPedir)
                                    {
                                        <input type="hidden" name="listaIdInsumoAlPedido" value="@item.IdInsumo" readonly />
                                        <input type="text" name="listaNombreInsumoAlPedido" value="@item.Insumo" readonly style="display:none;" />
                                        <input type="number" name="listaCantidadInsumoAlPedido" value="@item.Cantidad" readonly style="display:none;" />
                                    }
                                    @if (listado.Stock >= 5)
                                    {
                                        <button type="submit" class="btn btn-warning">Agregar</button>
                                    }
                                    else
                                    {
                                        <bold>Sin stock momentaneamente</bold>
                                    }

                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
            <div class="form-label-group text-danger pb-2">
                @ViewBag.insumoYaExiste
            </div>
        }
        else
        {
            <table class="tablacustom">
                <thead>
                    <tr>
                        <th class="text-center thfix">
                            Insumo
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">
                            No existe este insumo
                        </td>
                    </tr>
                </tbody>
            </table>
            <div>
                @foreach (var listado in Model.InsumosAPedir)
                {
                    @Html.HiddenFor(Model => Model.NuevaReservaVM.idReserva)
                    <input type="hidden" name="listaIdInsumoAlPedido" value="@listado.IdInsumo" />
                    <input type="hidden" name="listaNombreInsumoAlPedido" value="@listado.Insumo" readonly />
                    <input type="hidden" name="listaCantidadInsumoAlPedido" value="@listado.Cantidad" readonly />
                }
            </div>
        }
    </div>

    <div class="col-md-5">
        <h4 class="text-center">Insumos a reservar</h4>
        @if (Model.InsumosAPedir.Count != 0)
        {
            <table class="tablacustom">
                <thead>
                    <tr>
                        <th class="text-center thfix">
                            Insumo
                        </th>
                        <th class="text-center thfix">
                            Acciones
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var listado in Model.InsumosAPedir)
                    {
                        using (Html.BeginForm("QuitarInsumo", "Reserva", FormMethod.Post))
                        {
                            <tr>
                                <td class="text-center">
                                    @Html.HiddenFor(Model => Model.NuevaReservaVM.idReserva)
                                    <input type="hidden" name="buscarInsumoAnterior" value="@ViewBag.nombreInsumo" class="form-control" />
                                    <input type="hidden" name="IdInsumoAlPedido" value="@listado.IdInsumo" />
                                    <input type="text" name="NombreInsumoAlPedido" class="form-control nombreInsumo" placeholder="@listado.Insumo" value="@listado.Insumo" readonly />
                                </td>
                                <td class="text-center">
                                    @foreach (var item in Model.InsumosAPedir)
                                    {
                                        <input type="hidden" name="listaIdInsumoAlPedido" value="@item.IdInsumo" readonly />
                                        <input type="text" name="listaNombreInsumoAlPedido" value="@item.Insumo" readonly style="display:none;" />
                                        <input type="number" name="listaCantidadInsumoAlPedido" value="@item.Cantidad" readonly style="display:none;" />
                                    }
                                    <button type="submit" class="btn btn-warning">Quitar</button>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        }
        else
        {
            <table class="tablacustom">
                <thead>
                    <tr>
                        <th class="text-center thfix">
                            Insumo
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">
                            No hay insumos guardados todavía
                        </td>
                    </tr>
                </tbody>
            </table>
        }
    </div>
    <div class="col-md-1"></div>
</div>

<hr />

<div class="row" style="transform: translateY(60px); color: white">
    <div class="col-md-3"></div>
    <div class="col-md-6 text-center">
        @if (Model.InsumosAPedir.Count != 0)
        {
            <h4 class="text-center">Agregar cantidades y finalizar</h4>
            using (Html.BeginForm("InsertInsumosAReserva", "Reserva", FormMethod.Post))
            {
                <table class="tablacustom">
                    <thead>
                        <tr>
                            <th class="text-center thfix">
                                Insumo
                            </th>
                            <th class="text-center thfix">
                                Cantidad
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var listado in Model.InsumosAPedir)
                        {
                            <tr>
                                <td class="text-center">
                                    @Html.HiddenFor(Model => Model.NuevaReservaVM.idReserva)
                                    <input type="hidden" name="IdInsumoAlPedido" value="@listado.IdInsumo" style="display:none" />
                                    <input type="text" name="NombreInsumoAlPedido" class="form-control nombreInsumo" placeholder="@listado.Insumo" value="@listado.Insumo" readonly />
                                </td>
                                <td class="text-center">
                                    <input type="number" name="CantidadInsumoAlPedido" class="form-control cantidadInsumo" min="0" max="5" style="width:90px;" />
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
                <div class="form-label-group text-danger pb-2">
                    @ViewBag.cantidadIgualCero
                </div>
                <div class="form-group">
                    @if (sesion.equipo != null)
                    {
                        <div class="form-group">
                            <div class="col-lg-12">
                                <label class="control-label">Notificar a mi equipo</label>
                                @Html.CheckBox("enviarMails", false)
                            </div>
                        </div>
                    }
                    <button type="submit" class="btn btn-success">Finalizar</button>
                    @Html.ActionLink("Cancelar", "MisReservas", "Reserva", null, new { @class = "text-center btn btn-warning" })
                </div>
                <div class="form-label-group text-danger pb-2">
                    @ViewBag.errorRegistrarInsumos
                </div>
            }
        }
        else
        {
            @Html.ActionLink("Cancelar", "MisReservas", "Reserva", null, new { @class = "text-center btn btn-warning" })
        }
    </div>
    <div class="col-md-3"></div>
</div>

