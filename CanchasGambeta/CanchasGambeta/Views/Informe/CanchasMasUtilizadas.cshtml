@model IEnumerable<CanchasGambeta.ViewModels.CanchasMasReservadasVM>
@{
    ViewBag.Title = "CanchasMasUtilizadas";
}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div class="row" style="transform: translateY(70px); color:white">
    <div class="col-md-3"></div>
    <div class="col-md-6 text-center">
        <table class="table table-bordered table-striped" id="tablaCanchas" style="display:none;">
            <thead>
                <tr>
                    <th class="text-center">
                        Cancha
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var listado in Model)
                {
                    <tr class="text-center">
                        <td>
                            @listado.Cancha
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <table class="table table-bordered table-striped" id="tablaCantidadReservas" style="display:none;">
            <thead>
                <tr>
                    <th class="text-center">
                        Cantidad de veces reservada
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var listado in Model)
                {
                    <tr class="text-center">
                        <td>
                            @listado.Cantidad
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <div id="piechart" style="width: 700px; height: 400px;"></div>
        <small>*Nota: si una cancha no sale en el gráfico es porque no hay ninguna reserva en la misma.</small>
    </div>
    <div class="col-md-3"></div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>



    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {

        let titleArr = ['Canchas', 'Cantidad de reservas'];
        let arrayNeeded = [];
        let arrCanchas = [];
        let arrCantidadReservas = [];

        $("table#tablaCanchas tr").each(function () {
            var arrayOfThisRow = [];
            var tableData = $(this).find('td');
            if (tableData.length > 0) {
                tableData.each(function () { arrayOfThisRow.push($(this).text()); });
                arrCanchas.push(arrayOfThisRow);
            }
        });

        let arrCanchasString = [];
        for (var i = 0; i < arrCanchas.length; i++) {
            let valor = arrCanchas[i];
            valor = $.trim(valor);
            arrCanchasString.push(valor);
        };


        $("table#tablaCantidadReservas tr").each(function () {
            var arrayOfThisRow = [];
            var tableData = $(this).find('td');
            if (tableData.length > 0) {
                tableData.each(function () { arrayOfThisRow.push($(this).text()); });
                arrCantidadReservas.push(arrayOfThisRow);
            }
        });

        let arrCantidadReservasString = [];
        for (var i = 0; i < arrCantidadReservas.length; i++) {
            let valor = arrCantidadReservas[i];
            valor = parseInt($.trim(valor));
            arrCantidadReservasString.push(valor);
        };

        arrayNeeded.push(titleArr);
        arrCanchasString.map(function (item, index) {
            let tempArr = [];
            tempArr.push(arrCanchasString[index], arrCantidadReservasString[index]);
            arrayNeeded.push(tempArr);
        });

        var data = google.visualization.arrayToDataTable(arrayNeeded);

        var options = {
            title: 'Canchas más utilizadas',
            titleTextStyle: {
                color: 'white',
                fontSize: 30
            },
            backgroundColor: '#1A1A1D',
            legend: '',
            legendTextStyle: {
                color: 'white'
            }
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
    }
</script>
